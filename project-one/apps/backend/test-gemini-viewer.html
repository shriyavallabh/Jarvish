<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarvish - Gemini Image Generation Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0B1F33 0%, #1a3a52 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #CEA200;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            text-align: center;
            color: #8FA3B8;
            margin-bottom: 40px;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid rgba(206, 162, 0, 0.3);
        }
        
        .test-card h3 {
            color: #CEA200;
            margin-bottom: 15px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #B8C5D6;
            font-size: 0.9rem;
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            border-radius: 4px;
            font-family: inherit;
        }
        
        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        button {
            background: #CEA200;
            color: #0B1F33;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #B8930A;
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .result-container {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }
        
        .result-image {
            width: 100%;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .status {
            padding: 8px 12px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .status.success {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            border: 1px solid #4CAF50;
        }
        
        .status.error {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            border: 1px solid #f44336;
        }
        
        .status.loading {
            background: rgba(206, 162, 0, 0.2);
            color: #CEA200;
            border: 1px solid #CEA200;
        }
        
        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .template-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .template-card:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: #CEA200;
        }
        
        .template-card.selected {
            background: rgba(206, 162, 0, 0.2);
            border-color: #CEA200;
        }
        
        .api-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #f44336;
        }
        
        .status-dot.connected {
            background: #4CAF50;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="api-status">
        <div class="status-dot" id="apiStatusDot"></div>
        <span id="apiStatusText">Checking API...</span>
    </div>

    <div class="container">
        <h1>Jarvish Gemini Integration</h1>
        <p class="subtitle">AI-Powered Financial Infographic Generation</p>

        <!-- Quick Test Section -->
        <div class="test-section">
            <h2>Quick Test - Generate Image</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Content Configuration</h3>
                    <div class="input-group">
                        <label>Content Type</label>
                        <select id="contentType">
                            <option value="market-update">Market Update</option>
                            <option value="educational">Educational</option>
                            <option value="regulatory">Regulatory</option>
                            <option value="festival">Festival</option>
                            <option value="tax-planning">Tax Planning</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Language</label>
                        <select id="language">
                            <option value="en">English</option>
                            <option value="hi">Hindi</option>
                            <option value="mr">Marathi</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Format</label>
                        <select id="format">
                            <option value="post">WhatsApp Post (16:9)</option>
                            <option value="status">WhatsApp Status (9:16)</option>
                            <option value="linkedin">LinkedIn (1:1)</option>
                        </select>
                    </div>
                </div>

                <div class="test-card">
                    <h3>Content Details</h3>
                    <div class="input-group">
                        <label>Content Text</label>
                        <textarea id="contentText" placeholder="Enter your financial content here...">Sensex surges 850 points to close at 72,500. Banking and IT stocks lead the rally.</textarea>
                    </div>
                    <div class="input-group">
                        <label>Advisor Name (Optional)</label>
                        <input type="text" id="advisorName" placeholder="e.g., Rajesh Kumar, MFD">
                    </div>
                    <div class="input-group">
                        <label>EUIN (Optional)</label>
                        <input type="text" id="euin" placeholder="e.g., E123456">
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button onclick="generateImage()" id="generateBtn">Generate Image with Gemini</button>
            </div>

            <div id="resultContainer" class="result-container" style="display: none;">
                <h3>Generated Image</h3>
                <div id="resultStatus"></div>
                <img id="resultImage" class="result-image" style="display: none;">
                <pre id="resultMetadata" style="color: #8FA3B8; font-size: 0.85rem; margin-top: 10px;"></pre>
            </div>
        </div>

        <!-- Templates Section -->
        <div class="test-section">
            <h2>Content Templates</h2>
            <div class="templates-grid" id="templatesGrid">
                <!-- Templates will be loaded here -->
            </div>
        </div>

        <!-- Sample Prompts Section -->
        <div class="test-section">
            <h2>Sample Prompts</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Market Update</h3>
                    <p style="color: #B8C5D6; font-size: 0.9rem;">
                        "Sensex gains 850 points, closes at 72,500. IT sector up 3.2%, Banking +2.8%. 
                        FIIs net buyers at ₹2,500 crore."
                    </p>
                    <button onclick="useSample('market-update')">Use This</button>
                </div>
                <div class="test-card">
                    <h3>Educational (Hindi)</h3>
                    <p style="color: #B8C5D6; font-size: 0.9rem;">
                        "SIP के फायदे: छोटी राशि से शुरुआत, रुपया कॉस्ट एवरेजिंग, 
                        कंपाउंडिंग का लाभ, अनुशासित निवेश"
                    </p>
                    <button onclick="useSample('educational-hindi')">Use This</button>
                </div>
                <div class="test-card">
                    <h3>Tax Planning</h3>
                    <p style="color: #B8C5D6; font-size: 0.9rem;">
                        "Save ₹46,800 in taxes! Invest in ELSS funds under Section 80C. 
                        Deadline: March 31. Lock-in: 3 years only."
                    </p>
                    <button onclick="useSample('tax')">Use This</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API configuration
        const API_BASE_URL = 'http://localhost:3001/api/v1';
        
        // Sample content
        const samples = {
            'market-update': {
                content: 'Sensex gains 850 points, closes at 72,500. IT sector up 3.2%, Banking +2.8%. FIIs net buyers at ₹2,500 crore.',
                type: 'market-update',
                language: 'en'
            },
            'educational-hindi': {
                content: 'SIP के फायदे: छोटी राशि से शुरुआत, रुपया कॉस्ट एवरेजिंग, कंपाउंडिंग का लाभ, अनुशासित निवेश',
                type: 'educational',
                language: 'hi'
            },
            'tax': {
                content: 'Save ₹46,800 in taxes! Invest in ELSS funds under Section 80C. Deadline: March 31. Lock-in: 3 years only.',
                type: 'tax-planning',
                language: 'en'
            }
        };

        // Check API status on load
        async function checkAPIStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/`);
                const data = await response.json();
                
                if (data.message && data.message.includes('Jarvish')) {
                    document.getElementById('apiStatusDot').classList.add('connected');
                    document.getElementById('apiStatusText').textContent = 'API Connected';
                    loadTemplates();
                } else {
                    throw new Error('Invalid API response');
                }
            } catch (error) {
                document.getElementById('apiStatusText').textContent = 'API Offline';
                console.error('API check failed:', error);
            }
        }

        // Load templates
        async function loadTemplates() {
            try {
                const response = await fetch(`${API_BASE_URL}/images/templates`, {
                    headers: {
                        'Authorization': 'Bearer test-token'
                    }
                });
                const data = await response.json();
                
                if (data.success) {
                    const grid = document.getElementById('templatesGrid');
                    grid.innerHTML = '';
                    
                    Object.entries(data.templates).forEach(([key, template]) => {
                        const card = document.createElement('div');
                        card.className = 'template-card';
                        card.innerHTML = `
                            <h4 style="color: #CEA200; margin-bottom: 8px;">${template.name}</h4>
                            <p style="color: #B8C5D6; font-size: 0.85rem; margin-bottom: 8px;">${template.description}</p>
                            <div style="font-size: 0.8rem; color: #8FA3B8;">
                                <div>Languages: ${template.languages.join(', ')}</div>
                                <div>Formats: ${template.formats.join(', ')}</div>
                            </div>
                        `;
                        card.onclick = () => selectTemplate(key, template);
                        grid.appendChild(card);
                    });
                }
            } catch (error) {
                console.error('Failed to load templates:', error);
            }
        }

        // Select template
        function selectTemplate(key, template) {
            document.getElementById('contentType').value = key;
            document.getElementById('contentText').value = template.sampleContent;
            
            // Update selected state
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
        }

        // Use sample content
        function useSample(sampleKey) {
            const sample = samples[sampleKey];
            document.getElementById('contentType').value = sample.type;
            document.getElementById('language').value = sample.language;
            document.getElementById('contentText').value = sample.content;
        }

        // Generate image
        async function generateImage() {
            const generateBtn = document.getElementById('generateBtn');
            const resultContainer = document.getElementById('resultContainer');
            const resultStatus = document.getElementById('resultStatus');
            const resultImage = document.getElementById('resultImage');
            const resultMetadata = document.getElementById('resultMetadata');
            
            // Get form values
            const payload = {
                content: document.getElementById('contentText').value,
                contentType: document.getElementById('contentType').value,
                language: document.getElementById('language').value,
                format: document.getElementById('format').value,
                advisorName: document.getElementById('advisorName').value,
                euin: document.getElementById('euin').value,
                includeDisclaimer: true
            };
            
            // Show loading state
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';
            resultContainer.style.display = 'block';
            resultStatus.className = 'status loading';
            resultStatus.textContent = 'Generating image with Gemini AI...';
            resultImage.style.display = 'none';
            resultMetadata.textContent = '';
            
            try {
                const response = await fetch(`${API_BASE_URL}/images/test-gemini`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Show success
                    resultStatus.className = 'status success';
                    resultStatus.textContent = 'Image generated successfully!';
                    
                    // Display image
                    resultImage.src = `data:${data.testImage.mimeType};base64,${data.testImage.data}`;
                    resultImage.style.display = 'block';
                    
                    // Show metadata
                    resultMetadata.textContent = JSON.stringify({
                        dimensions: data.testImage.dimensions,
                        sizeKB: data.testImage.sizeKB,
                        model: 'gemini-2.0-flash-exp'
                    }, null, 2);
                } else {
                    throw new Error(data.message || 'Generation failed');
                }
            } catch (error) {
                resultStatus.className = 'status error';
                resultStatus.textContent = `Error: ${error.message}`;
                console.error('Generation failed:', error);
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate Image with Gemini';
            }
        }

        // Initialize on load
        window.onload = () => {
            checkAPIStatus();
        };
    </script>
</body>
</html>